import pefile
import os
from PIL import Image

def vlsualization_malware(dataset, outputfile, width=0):
    global size
    if(width == 0):
        size = len(dataset)
        width = 256

    heigher = int(size / width) + 1

    image = Image.new("L", (width, heigher))
    image.putdata(dataset)

    imagename = outputfile + ".png"
    image.save(imagename)
    image.show()
    print(imagename + "good")

exe_path = "normalFile/al.exe"
pe = pefile.PE(exe_path)
for section in pe.sections: 
    print(section.Name.decode('utf-8'))
    name = section.Name
    
    if section.Name.decode().rstrip('\x00') =='.text':
        vlsualization_malware(
            dataset=section.get_data(),
            outputfile=os.path.basename(exe_path)
        )
    
    png_name=section.Name.decode().rstrip('\x00')
    #vlsualization_malware(dataset=section.get_data(),outputfile="section" + png_name)